
set(CMAKE_POLICY_DEFAULT_CMP0077 NEW)
SET(CMAKE_EXPORT_COMPILE_COMMANDS ON)

CMAKE_MINIMUM_REQUIRED(VERSION 3.20)
MESSAGE(STATUS "======================")
MESSAGE(STATUS "Starting rust demo ")
MESSAGE(STATUS "======================")
#

#SET(LN_LTO "-flto"  CACHE INTERNAL "")
#SET(LN_ENABLE_USBD  OFF CACHE INTERNAL "")
SET(LN_ENABLE_I2C   FALSE CACHE INTERNAL "")
SET(LN_ENABLE_SPI   FALSE CACHE INTERNAL "")
SET(ESPRIT_ROOT  ${CMAKE_SOURCE_DIR}/esprit)
SET(LN_ENABLE_RUST ON CACHED "")

SET(CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR}/../..)
INCLUDE(common_CMakeLists)

SET(CMAKE_TOOLCHAIN_FILE ${ESPRIT_ROOT}/esprit.cmake)
SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_CURRENT_SOURCE_DIR}/cmake ${ESPRIT_ROOT}/cmake CACHE INTERNAL "")

PROJECT(lnRUST_DEMO NONE) # the NONE is very important !

enable_language(C CXX ASM) # this is important too!

ADD_SUBDIRECTORY(${ESPRIT_ROOT})

INCLUDE(${ESPRIT_ROOT}/setup.cmake)
GENERATE_GD32_FIRMWARE(lnDEMO src/demo.cpp)


ADD_SUBDIRECTORY(rust)
target_link_libraries(lnDEMO PRIVATE rust_demo)
